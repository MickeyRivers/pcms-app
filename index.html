<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PCMS Field Data Collector</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=Work+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
<style>
:root {
  --forest: #1a4d2e;
  --moss: #2d6a3f;
  --gold: #ffd60a;
  --cream: #fffef7;
  --slate: #2b2d42;
  --steel: #8d99ae;
  --shadow: rgba(0,0,0,0.15);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Work Sans', sans-serif;
  background: linear-gradient(135deg, #0d1b2a 0%, #1b263b 100%);
  color: var(--cream);
  min-height: 100vh;
  overflow-x: hidden;
}

.app {
  max-width: 98vw;
  margin: 0 auto;
  padding: 20px;
}

header {
  background: linear-gradient(135deg, var(--forest) 0%, var(--moss) 100%);
  padding: 30px 40px;
  border-radius: 16px;
  margin-bottom: 25px;
  box-shadow: 0 8px 32px var(--shadow);
  border: 2px solid rgba(255, 214, 10, 0.2);
}

h1 {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 2.2rem;
  color: var(--gold);
  margin-bottom: 8px;
  letter-spacing: -0.5px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.subtitle {
  font-size: 1.05rem;
  opacity: 0.95;
  font-weight: 400;
}

.controls {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
  flex-wrap: wrap;
  align-items: center;
}

.btn {
  padding: 10px 24px;
  border: 2px solid var(--gold);
  border-radius: 8px;
  background: var(--forest);
  color: var(--gold);
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s;
  font-family: 'Work Sans', sans-serif;
}

.btn:hover {
  background: var(--moss);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 214, 10, 0.3);
}

.btn-secondary {
  background: rgba(45, 106, 63, 0.3);
  border-color: rgba(255, 214, 10, 0.5);
}

.spreadsheet-container {
  background: rgba(27, 38, 59, 0.95);
  border-radius: 12px;
  padding: 20px;
  overflow-x: auto;
  box-shadow: 0 4px 24px var(--shadow);
  border: 2px solid rgba(255, 214, 10, 0.2);
}

.spreadsheet {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
  font-family: 'IBM Plex Mono', monospace;
}

.spreadsheet thead {
  background: linear-gradient(135deg, var(--forest) 0%, var(--moss) 100%);
  position: sticky;
  top: 0;
  z-index: 10;
}

.spreadsheet th {
  padding: 12px 8px;
  text-align: left;
  font-weight: 700;
  color: var(--gold);
  border: 1px solid rgba(255, 214, 10, 0.3);
  white-space: nowrap;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  min-width: 120px;
}

.spreadsheet td {
  padding: 0;
  border: 1px solid rgba(141, 153, 174, 0.2);
  background: rgba(13, 27, 42, 0.6);
}

.spreadsheet input, .spreadsheet select {
  width: 100%;
  padding: 10px 8px;
  border: none;
  background: transparent;
  color: var(--cream);
  font-size: 12px;
  font-family: 'IBM Plex Mono', monospace;
  transition: background 0.2s;
}

.spreadsheet input:focus, .spreadsheet select:focus {
  background: rgba(26, 77, 46, 0.3);
  outline: none;
}

.spreadsheet tbody tr:hover {
  background: rgba(26, 77, 46, 0.15);
}

.row-number {
  background: rgba(45, 106, 63, 0.3) !important;
  text-align: center;
  font-weight: 700;
  color: var(--gold);
  min-width: 50px;
}

.photo-cell {
  padding: 8px !important;
  min-width: 180px;
}

.photo-actions {
  display: flex;
  gap: 5px;
  margin-bottom: 8px;
}

.photo-btn {
  flex: 1;
  padding: 8px 6px;
  background: rgba(45, 106, 63, 0.5);
  border: 2px solid rgba(255, 214, 10, 0.5);
  border-radius: 6px;
  color: var(--gold);
  font-size: 11px;
  cursor: pointer;
  text-align: center;
  transition: all 0.3s;
  font-family: 'Work Sans', sans-serif;
  font-weight: 600;
}

.photo-btn:hover {
  background: rgba(45, 106, 63, 0.7);
  border-style: solid;
}

.photo-btn input[type="file"] {
  display: none;
}

.photo-thumbnails {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
}

.photo-thumb {
  position: relative;
  width: 50px;
  height: 50px;
  border-radius: 4px;
  overflow: hidden;
  border: 2px solid rgba(255, 214, 10, 0.3);
  cursor: pointer;
}

.photo-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.photo-thumb-remove {
  position: absolute;
  top: -4px;
  right: -4px;
  background: #ff4444;
  color: white;
  border: none;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  font-size: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.photo-count {
  font-size: 10px;
  color: var(--gold);
  margin-top: 4px;
  text-align: center;
}

.photo-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 40px;
}

.photo-modal-content {
  max-width: 90vw;
  max-height: 90vh;
  position: relative;
}

.photo-modal-content img {
  max-width: 100%;
  max-height: 90vh;
  border-radius: 8px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
}

.photo-modal-close {
  position: absolute;
  top: -40px;
  right: 0;
  background: var(--gold);
  color: var(--forest);
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  font-size: 24px;
  cursor: pointer;
  font-weight: 700;
}

.camera-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.95);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
}

.camera-view {
  position: relative;
  max-width: 90vw;
  max-height: 70vh;
}

.camera-view video, .camera-view canvas {
  max-width: 100%;
  max-height: 70vh;
  border-radius: 8px;
  border: 3px solid var(--gold);
}

.camera-controls {
  display: flex;
  gap: 15px;
  margin-top: 20px;
}

.camera-btn {
  padding: 15px 30px;
  border: 2px solid var(--gold);
  border-radius: 8px;
  background: var(--forest);
  color: var(--gold);
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
}

.camera-btn:hover {
  background: var(--moss);
  transform: scale(1.05);
}

.camera-btn.capture {
  background: var(--gold);
  color: var(--forest);
}

.add-row-btn {
  margin-top: 15px;
  width: 100%;
  padding: 12px;
  background: rgba(45, 106, 63, 0.3);
  border: 2px dashed rgba(255, 214, 10, 0.5);
  color: var(--gold);
  font-weight: 600;
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.3s;
}

.add-row-btn:hover {
  background: rgba(45, 106, 63, 0.5);
  border-style: solid;
}

.status {
  padding: 15px;
  margin: 15px 0;
  border-radius: 8px;
  font-weight: 600;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.status.success {
  background: rgba(26, 77, 46, 0.8);
  border: 2px solid var(--gold);
  color: var(--gold);
}

.status.error {
  background: rgba(139, 0, 0, 0.8);
  border: 2px solid #ff4444;
  color: #fff;
}

.status button {
  background: none;
  border: none;
  color: inherit;
  font-size: 20px;
  cursor: pointer;
  padding: 0 10px;
}

@media (max-width: 1200px) {
  .spreadsheet {
    font-size: 11px;
  }
  .spreadsheet th {
    font-size: 10px;
  }
}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef } = React;

const EQUIPMENT_DB = [
  {"serial":"211108873","customer":"Staff WSC","facility":"Eastland County Water Supply","manufacturer":"Octave Master Meter 6\""},
  {"serial":"S16317668","customer":"Staff WSC","facility":"La Casa","manufacturer":"Khrone WATERFLUX 3070 C"},
  {"serial":"221100217","customer":"Staff WSC","facility":"Master Meter","manufacturer":"Octave Master Meter 6\""},
  {"serial":"74453","customer":"West Travis County PUA","facility":"Plant 1 & 2 Final","manufacturer":"Greyline OCF 5"},
  {"serial":"N1F1887T","customer":"West Travis County PUA","facility":"CCNG Raw at Spanish Oaks","manufacturer":"Fuji Delta C"},
  {"serial":"R3060716000","customer":"New Braunfels Utilities","facility":"Weltner Rd. Pumps","manufacturer":"E&H Promag 400"},
  {"serial":"73701","customer":"New Braunfels Utilities","facility":"Sam McKenzie Effluent","manufacturer":"Greyline OCF 5.0"}
];

// Column visibility by service type
const COLUMN_CONFIG = {
  "Closed pipe": ["date", "customer", "facility", "serviceType", "manufacturer", "serialNumber", "meterReading", "method", "pipeMaterial", "pipeSize", "units", "validatingFlow", "customerFlow", "photos", "notes", "testedBy"],
  "Open Channel": ["date", "customer", "facility", "serviceType", "manufacturer", "serialNumber", "method", "primaryDevice", "units", "levelChannel", "levelMeter", "photos", "notes", "testedBy"],
  "Chart Recorder": ["date", "customer", "facility", "serviceType", "manufacturer", "serialNumber", "primaryDevice", "units", "valueMeter", "valueChart", "photos", "notes", "testedBy"],
  "Loop Test": ["date", "customer", "facility", "serviceType", "manufacturer", "serialNumber", "method", "lowDesired", "lowMeasured", "highDesired", "highMeasured", "photos", "notes", "testedBy"],
  "Startup": ["date", "customer", "facility", "serviceType", "manufacturer", "serialNumber", "method", "primaryDevice", "units", "photos", "notes", "testedBy"]
};

const COLUMN_LABELS = {
  date: "Date",
  customer: "Customer",
  facility: "Facility/Location",
  serviceType: "Service Type",
  manufacturer: "Manufacturer/Model",
  serialNumber: "Serial Number",
  meterReading: "Meter Reading",
  method: "Method",
  pipeMaterial: "Pipe Material",
  pipeSize: "Pipe Size",
  primaryDevice: "Primary Device",
  units: "Units",
  validatingFlow: "Validating Flow",
  customerFlow: "Customer Flow",
  levelChannel: "Level Channel",
  levelMeter: "Level Meter",
  valueMeter: "Value on Meter",
  valueChart: "Value on Chart",
  lowDesired: "Low Desired (mA)",
  lowMeasured: "Low Measured (mA)",
  highDesired: "High Desired (mA)",
  highMeasured: "High Measured (mA)",
  photos: "üì∏ Photos",
  notes: "Notes",
  testedBy: "Tested By"
};

function App() {
  const [rows, setRows] = useState([]);
  const [status, setStatus] = useState(null);
  const [photoModal, setPhotoModal] = useState(null);
  const [cameraModal, setCameraModal] = useState(null);
  const videoRef = useRef(null);
  const canvasRef = useRef(null);
  const streamRef = useRef(null);

  useEffect(() => {
    addNewRow();
  }, []);

  const createEmptyRow = () => ({
    id: Date.now() + Math.random(),
    date: new Date().toISOString().split('T')[0],
    customer: "",
    facility: "",
    serviceType: "Closed pipe",
    manufacturer: "",
    serialNumber: "",
    meterReading: "",
    method: "Ultrasonic",
    pipeMaterial: "",
    pipeSize: "",
    primaryDevice: "",
    units: "GPM",
    validatingFlow: "",
    customerFlow: "",
    levelChannel: "",
    levelMeter: "",
    valueMeter: "",
    valueChart: "",
    lowDesired: "",
    lowMeasured: "",
    highDesired: "",
    highMeasured: "",
    notes: "",
    testedBy: "Mick Bartlett",
    photos: []
  });

  const addNewRow = () => {
    setRows([...rows, createEmptyRow()]);
  };

  const updateRow = (id, field, value) => {
    setRows(rows.map(row => 
      row.id === id ? { ...row, [field]: value } : row
    ));
  };

  const deleteRow = (id) => {
    if (rows.length > 1) {
      setRows(rows.filter(row => row.id !== id));
    }
  };

  const autofillFromSerial = (id, serial) => {
    const equipment = EQUIPMENT_DB.find(e => e.serial === serial);
    if (equipment) {
      setRows(rows.map(row => 
        row.id === id ? {
          ...row,
          serialNumber: serial,
          customer: equipment.customer,
          facility: equipment.facility,
          manufacturer: equipment.manufacturer
        } : row
      ));
    } else {
      updateRow(id, 'serialNumber', serial);
    }
  };

  const handlePhotoUpload = (rowId, files) => {
    const fileArray = Array.from(files);
    
    fileArray.forEach(file => {
      const reader = new FileReader();
      reader.onload = (e) => {
        setRows(prevRows => prevRows.map(row => {
          if (row.id === rowId) {
            return {
              ...row,
              photos: [...row.photos, {
                id: Date.now() + Math.random(),
                data: e.target.result,
                name: file.name
              }]
            };
          }
          return row;
        }));
      };
      reader.readAsDataURL(file);
    });
  };

  const startCamera = async (rowId) => {
    setCameraModal(rowId);
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ 
        video: { facingMode: 'environment' } // Use back camera on mobile
      });
      streamRef.current = stream;
      setTimeout(() => {
        if (videoRef.current) {
          videoRef.current.srcObject = stream;
        }
      }, 100);
    } catch (err) {
      setStatus({ type: 'error', msg: 'Camera access denied: ' + err.message });
      setCameraModal(null);
    }
  };

  const capturePhoto = () => {
    const video = videoRef.current;
    const canvas = canvasRef.current;
    const context = canvas.getContext('2d');
    
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    context.drawImage(video, 0, 0);
    
    const photoData = canvas.toDataURL('image/jpeg', 0.8);
    
    setRows(prevRows => prevRows.map(row => {
      if (row.id === cameraModal) {
        return {
          ...row,
          photos: [...row.photos, {
            id: Date.now() + Math.random(),
            data: photoData,
            name: `photo_${new Date().getTime()}.jpg`
          }]
        };
      }
      return row;
    }));
    
    setStatus({ type: 'success', msg: 'Photo captured!' });
  };

  const closeCamera = () => {
    if (streamRef.current) {
      streamRef.current.getTracks().forEach(track => track.stop());
    }
    setCameraModal(null);
  };

  const removePhoto = (rowId, photoId) => {
    setRows(rows.map(row => {
      if (row.id === rowId) {
        return {
          ...row,
          photos: row.photos.filter(p => p.id !== photoId)
        };
      }
      return row;
    }));
  };

  const getVisibleColumns = (serviceType) => {
    return COLUMN_CONFIG[serviceType] || COLUMN_CONFIG["Closed pipe"];
  };

  const exportToExcel = () => {
    try {
      const allColumns = ["date", "customer", "facility", "serviceType", "manufacturer", "serialNumber", 
                         "meterReading", "method", "pipeMaterial", "pipeSize", "primaryDevice", "units", 
                         "validatingFlow", "customerFlow", "levelChannel", "levelMeter", "valueMeter", 
                         "valueChart", "lowDesired", "lowMeasured", "highDesired", "highMeasured", 
                         "notes", "testedBy"];
      
      const csvContent = [
        ["Date", "Customer", "Facility/Location", "Service Type", "Manufacturer/Model", "Serial Number",
         "Meter Reading", "Method", "Pipe Material", "Pipe Size", "Primary Device", "Units",
         "Validating Flow", "Customer Flow", "Level Channel", "Level Meter", "Value Meter",
         "Value Chart", "Low Desired", "Low Measured", "High Desired", "High Measured",
         "Notes", "Tested By", "Photo Count"],
        ...rows.map(row => [
          ...allColumns.map(col => row[col] || ""),
          row.photos.length
        ])
      ].map(row => row.join('\t')).join('\n');

      const blob = new Blob([csvContent], { type: 'text/tab-separated-values' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `PCMS_Data_${new Date().toISOString().split('T')[0]}.tsv`;
      a.click();
      URL.revokeObjectURL(url);
      
      setStatus({ type: 'success', msg: 'Exported to Excel/TSV format!' });
    } catch (err) {
      setStatus({ type: 'error', msg: 'Export error: ' + err.message });
    }
  };

  const generatePDFs = () => {
    try {
      const { jsPDF } = window.jspdf;
      
      rows.forEach((row) => {
        const doc = new jsPDF();
        
        doc.setFontSize(18);
        doc.setTextColor(26, 77, 46);
        doc.text("YOUR GO-TO FLOW PROS", 105, 20, { align: "center" });
        doc.setFontSize(11);
        doc.setTextColor(0, 0, 0);
        doc.text("Flow Measurement Testing & Calibration Services", 105, 27, { align: "center" });
        
        doc.setFontSize(14);
        doc.text(`${row.serviceType} Certificate`, 105, 40, { align: "center" });
        
        const visibleColumns = getVisibleColumns(row.serviceType);
        const tableData = visibleColumns
          .filter(col => col !== 'photos' && row[col])
          .map(col => [COLUMN_LABELS[col], row[col]]);
        
        doc.autoTable({
          startY: 50,
          head: [['Field', 'Value']],
          body: tableData,
          theme: 'grid',
          headStyles: { fillColor: [26, 77, 46], textColor: [255, 214, 10] },
          styles: { fontSize: 9 }
        });
        
        if (row.photos.length > 0) {
          let yPos = doc.lastAutoTable.finalY + 15;
          doc.setFontSize(12);
          doc.text("Field Photos:", 20, yPos);
          yPos += 10;
          
          row.photos.forEach((photo, i) => {
            if (yPos > 250) {
              doc.addPage();
              yPos = 20;
            }
            try {
              doc.addImage(photo.data, 'JPEG', 20, yPos, 80, 60);
              doc.setFontSize(9);
              doc.text(`Photo ${i + 1}`, 105, yPos + 5);
              yPos += 70;
            } catch (e) {
              console.log("Error adding photo:", e);
            }
          });
        }
        
        const pageCount = doc.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
          doc.setPage(i);
          doc.setFontSize(9);
          doc.text("Certified by YOUR GO-TO FLOW PROS", 105, 285, { align: "center" });
        }
        
        doc.save(`${row.customer}_${row.serialNumber}_${row.date}.pdf`);
      });
      
      setStatus({ type: 'success', msg: `Generated ${rows.length} certificates!` });
    } catch (err) {
      setStatus({ type: 'error', msg: 'PDF error: ' + err.message });
    }
  };

  const renderCell = (row, column) => {
    switch(column) {
      case 'date':
        return <input type="date" value={row.date} onChange={e => updateRow(row.id, 'date', e.target.value)} />;
      
      case 'serviceType':
        return (
          <select value={row.serviceType} onChange={e => updateRow(row.id, 'serviceType', e.target.value)}>
            <option>Closed pipe</option>
            <option>Open Channel</option>
            <option>Chart Recorder</option>
            <option>Loop Test</option>
            <option>Startup</option>
          </select>
        );
      
      case 'serialNumber':
        return (
          <input 
            type="text" 
            value={row.serialNumber} 
            onChange={e => autofillFromSerial(row.id, e.target.value)} 
            placeholder="Serial (autofills)" 
            list="serialList"
          />
        );
      
      case 'method':
        return (
          <select value={row.method} onChange={e => updateRow(row.id, 'method', e.target.value)}>
            <option>Ultrasonic</option>
            <option>Doppler</option>
            <option>Level Measurement</option>
            <option>Flow Meter Comparison</option>
            <option>New Meter Startup</option>
          </select>
        );
      
      case 'pipeMaterial':
        return (
          <select value={row.pipeMaterial} onChange={e => updateRow(row.id, 'pipeMaterial', e.target.value)}>
            <option value="">-</option>
            <option>PVC</option>
            <option>Ductile Iron</option>
            <option>Carbon Steel</option>
            <option>Stainless Steel</option>
            <option>Copper</option>
          </select>
        );
      
      case 'units':
        return (
          <select value={row.units} onChange={e => updateRow(row.id, 'units', e.target.value)}>
            <option>GPM</option>
            <option>MGD</option>
            <option>CFS</option>
            <option>Inches</option>
            <option>Feet</option>
          </select>
        );
      
      case 'photos':
        return (
          <div className="photo-cell">
            <div className="photo-actions">
              <button className="photo-btn" onClick={() => startCamera(row.id)}>
                üì∑ Camera
              </button>
              <label className="photo-btn">
                üìÅ Upload
                <input 
                  type="file" 
                  accept="image/*" 
                  multiple 
                  onChange={e => handlePhotoUpload(row.id, e.target.files)}
                />
              </label>
            </div>
            {row.photos.length > 0 && (
              <>
                <div className="photo-thumbnails">
                  {row.photos.map(photo => (
                    <div key={photo.id} className="photo-thumb" onClick={() => setPhotoModal(photo.data)}>
                      <img src={photo.data} alt="Field" />
                      <button 
                        className="photo-thumb-remove" 
                        onClick={(e) => {e.stopPropagation(); removePhoto(row.id, photo.id);}}
                      >
                        ‚úï
                      </button>
                    </div>
                  ))}
                </div>
                <div className="photo-count">{row.photos.length} photo(s)</div>
              </>
            )}
          </div>
        );
      
      case 'validatingFlow':
      case 'customerFlow':
      case 'levelChannel':
      case 'levelMeter':
      case 'valueMeter':
      case 'valueChart':
      case 'lowDesired':
      case 'lowMeasured':
      case 'highDesired':
      case 'highMeasured':
        return <input type="number" step="0.01" value={row[column]} onChange={e => updateRow(row.id, column, e.target.value)} />;
      
      default:
        return <input type="text" value={row[column]} onChange={e => updateRow(row.id, column, e.target.value)} placeholder={COLUMN_LABELS[column]} />;
    }
  };

  return (
    <div className="app">
      <header>
        <h1>üì∏ PCMS Field Data Collector</h1>
        <div className="subtitle">Dynamic Columns + Camera Support | {EQUIPMENT_DB.length} Equipment Records</div>
      </header>

      {status && (
        <div className={`status ${status.type}`}>
          {status.msg}
          <button onClick={() => setStatus(null)}>‚úï</button>
        </div>
      )}

      <div className="controls">
        <button className="btn" onClick={addNewRow}>+ Add Row</button>
        <button className="btn btn-secondary" onClick={exportToExcel}>üìä Export to Excel</button>
        <button className="btn btn-secondary" onClick={generatePDFs}>üìÑ Generate {rows.length} PDF(s)</button>
      </div>

      <div className="spreadsheet-container">
        <table className="spreadsheet">
          <thead>
            <tr>
              <th className="row-number">#</th>
              {rows.length > 0 && getVisibleColumns(rows[0].serviceType).map(col => (
                <th key={col}>{COLUMN_LABELS[col]}</th>
              ))}
              <th className="row-number">‚úï</th>
            </tr>
          </thead>
          <tbody>
            {rows.map((row, index) => {
              const visibleCols = getVisibleColumns(row.serviceType);
              return (
                <tr key={row.id}>
                  <td className="row-number">{index + 1}</td>
                  {visibleCols.map(col => (
                    <td key={col}>{renderCell(row, col)}</td>
                  ))}
                  <td className="row-number">
                    <button onClick={() => deleteRow(row.id)} style={{background:'none',border:'none',color:'#ff4444',cursor:'pointer',fontSize:'16px'}}>‚úï</button>
                  </td>
                </tr>
              );
            })}
          </tbody>
        </table>
        
        <datalist id="serialList">
          {EQUIPMENT_DB.map(e => <option key={e.serial} value={e.serial} />)}
        </datalist>
        
        <button className="add-row-btn" onClick={addNewRow}>+ Add New Row</button>
      </div>

      {photoModal && (
        <div className="photo-modal" onClick={() => setPhotoModal(null)}>
          <div className="photo-modal-content">
            <button className="photo-modal-close" onClick={() => setPhotoModal(null)}>‚úï</button>
            <img src={photoModal} alt="Full size" />
          </div>
        </div>
      )}

      {cameraModal && (
        <div className="camera-modal">
          <div className="camera-view">
            <video ref={videoRef} autoPlay playsInline style={{display: 'block'}}></video>
            <canvas ref={canvasRef} style={{display: 'none'}}></canvas>
          </div>
          <div className="camera-controls">
            <button className="camera-btn capture" onClick={capturePhoto}>üì∏ Capture</button>
            <button className="camera-btn" onClick={closeCamera}>‚úï Cancel</button>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
